<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Context | Fastro</title>
<meta name=keywords content="go">
<meta name=description content="Memahami context.WithTimeout di golang dan cara menggunakannya.">
<meta name=author content="
Admin">
<link rel=canonical href=https://fastro.dev/posts/context/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c5b21ba3e7fcf6cf4864656416c0b45547191189c7a1c61e231ae02b81609c4b.css integrity="sha256-xbIbo+f89s9IZGVkFsC0VUcZEYnHocYeIxrgK4FgnEs=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fastro.dev/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://fastro.dev/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://fastro.dev/favicon-32x32.png>
<link rel=apple-touch-icon href=https://fastro.dev/apple-touch-icon.png>
<link rel=mask-icon href=https://fastro.dev/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.91.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-165990288-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Context">
<meta property="og:description" content="Memahami context.WithTimeout di golang dan cara menggunakannya.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://fastro.dev/posts/context/"><meta property="og:image" content="https://fastro.dev/seo.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-12-25T00:00:00+00:00">
<meta property="article:modified_time" content="2021-12-25T00:00:00+00:00">
<meta property="og:see_also" content="https://fastro.dev/posts/interface/"><meta property="og:see_also" content="https://fastro.dev/posts/cancel/"><meta property="og:see_also" content="https://fastro.dev/posts/marshal/"><meta property="og:see_also" content="https://fastro.dev/posts/repository/"><meta property="og:see_also" content="https://fastro.dev/posts/mongodb/">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://fastro.dev/seo.png">
<meta name=twitter:title content="Context">
<meta name=twitter:description content="Memahami context.WithTimeout di golang dan cara menggunakannya.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://fastro.dev/posts/"},{"@type":"ListItem","position":3,"name":"Context","item":"https://fastro.dev/posts/context/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Context","name":"Context","description":"Memahami context.WithTimeout di golang dan cara menggunakannya.","keywords":["go"],"articleBody":"Catatan ini berisi penjelasan se-simple mungkin tentang context.WithTimeout di golang dan cara menggunakannya.\nPendahuluan Pada catatan sebelumnya:\n saat injeksi client di method createBookRepository saat pemanggilan collection di setiap method.  Ada satu argumen yang selalu kita isi dengan context.TODO(). Kalau kita teliti lagi, tipe argumen ini adalah context.Context.\nYang jadi pertanyaan: apa sih gunanya?\nSimulasi Dalam keadaan normal, internet stabil, jaringan bagus – penggunaan Context seperti di atas tak ada masalah. Kembalian dari tiap method sudah berjalan seperti yang diharapkan.\nNamun bayangkan, jika koneksi internet tiba-tiba terganggu dan kita perlu melakukan pembatalan query (transaksi) karena itu.\nAgar lebih memahami cara kerjanya, kita akan buat satu fungsi untuk membuat simulasinya.\nFungsi ini punya 2 argumen. Argumen ke-1 menerima Context. Sedangkan argumen ke-2 menerima Duration.\nfunc task(ctx context.Context, taskTime time.Duration) { str := \"\" select { case `Aduh, udah timeout! padahal belum kelar.` fmt.Println(str) case `Yes, mantap! kerjaan kelar.` fmt.Println(str) } } Argumen ke-1 digunakan untuk simulasi timeout. Sedang argumen ke-2 untuk simulasi berapa lama waktu yang diperlukan untuk menyelesaikan task tsb.\n Kode di atas menggunakan channel. Info selengkapnya bisa diakses di sini: https://go.dev/tour/concurrency/2\n Pekerjaan belum selesai, tapi sudah timeout func main() { fmt.Println(`Contoh: kerjaan belum selesai tapi sudah timeout:`) durasiKerjaan := 3 * time.Second // 3 detik \ttimeout := time.Second // 1 detik  ctx, cancel := context.WithTimeout(context.Background(), timeout) defer cancel() task(ctx, durasiKerjaan) } Kode selengkapnya: lihat di sini\nPada kode di atas, durasi task adalah 3 detik. Tapi timeout-nya lebih cepat.\nSehingga jika kode di atas kita jalankan, hasilnya:\nContoh: kerjaan belum selesai tapi sudah timeout: Aduh, udah timeout! padahal belum kelar. Pekerjaan sudah selesai duluan sebelum timeout func main() { fmt.Println(`Contoh: kerjaan sudah selesai duluan`) durasiKerjaan := time.Second // 1 detik \ttimeout := 3 * time.Second // 3 detik  ctx, cancel := context.WithTimeout(context.Background(), timeout) defer cancel() task(ctx, durasiKerjaan) } Kode selengkapnya: lihat di sini\nPada kode di atas, durasi kerjaan 1 detik. Sedangkan timeout 3 detik.\nSehingga jika kita jalankan, hasilnya:\nContoh: kerjaan sudah selesai duluan Yes, mantap! kerjaan kelar. Kesimpulan Kita bisa menggunakan context.WithTimeout jika ingin menambahkan pembatalan sebuah pekerjaan jika durasinya melebihi timeout.\n","wordCount":"350","inLanguage":"en","datePublished":"2021-12-25T00:00:00Z","dateModified":"2021-12-25T00:00:00Z","author":{"@type":"Person","name":"Admin"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fastro.dev/posts/context/"},"publisher":{"@type":"Organization","name":"Fastro","logo":{"@type":"ImageObject","url":"https://fastro.dev/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class="main-header header">
<nav class=nav>
<div class=logo>
<a href=https://fastro.dev accesskey=h title="Fastro (Alt + H)">
Fastro</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
</nav>
</header><main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Context
</h1>
<div class=post-meta><span title="2021-12-25 00:00:00 +0000 UTC">December 25, 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;
<a href=/authors/admin/>Admin</a>&nbsp;|&nbsp;<a href=https://github.com/fastrodev/fastrodev.github.io/blob/main/content/posts/context.md rel="noopener noreferrer" target=_blank>Update</a>
</div>
</header> <div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#pendahuluan aria-label=Pendahuluan>Pendahuluan</a></li>
<li>
<a href=#simulasi aria-label=Simulasi>Simulasi</a></li>
<li>
<a href=#pekerjaan-belum-selesai-tapi-sudah-timeout aria-label="Pekerjaan belum selesai, tapi sudah timeout">Pekerjaan belum selesai, tapi sudah timeout</a></li>
<li>
<a href=#pekerjaan-sudah-selesai-duluan-sebelum-timeout aria-label="Pekerjaan sudah selesai duluan sebelum timeout">Pekerjaan sudah selesai duluan sebelum timeout</a></li>
<li>
<a href=#kesimpulan aria-label=Kesimpulan>Kesimpulan</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>Catatan ini berisi penjelasan se-<em>simple</em> mungkin tentang <code>context.WithTimeout</code> di golang dan cara menggunakannya.</p>
<h3 id=pendahuluan>Pendahuluan<a hidden class=anchor aria-hidden=true href=#pendahuluan>#</a></h3>
<p>Pada catatan <a href=/posts/repository>sebelumnya</a>:</p>
<ul>
<li>saat injeksi client di method <a href=https://github.com/fastrodev/praktikum-repository/blob/2c985f11a3aa23d807b9693206f741dbfe3bb8aa/main.go#L20><code>createBookRepository</code></a></li>
<li>saat pemanggilan collection di <a href=https://github.com/fastrodev/praktikum-repository/blob/2c985f11a3aa23d807b9693206f741dbfe3bb8aa/main.go#L33>setiap method</a>.</li>
</ul>
<p>Ada satu argumen yang selalu kita isi dengan <code>context.TODO()</code>. Kalau kita teliti lagi, tipe argumen ini adalah <code>context.Context</code>.</p>
<p>Yang jadi pertanyaan: apa <em>sih</em> gunanya?</p>
<h3 id=simulasi>Simulasi<a hidden class=anchor aria-hidden=true href=#simulasi>#</a></h3>
<p>Dalam keadaan normal, internet stabil, jaringan bagus &ndash; penggunaan <code>Context</code> seperti di atas tak ada masalah. Kembalian dari tiap method sudah berjalan seperti yang diharapkan.</p>
<p>Namun bayangkan, jika koneksi internet tiba-tiba terganggu dan kita perlu melakukan pembatalan query (transaksi) karena itu.</p>
<p>Agar lebih memahami cara kerjanya, kita akan buat satu fungsi untuk membuat simulasinya.</p>
<p>Fungsi ini punya 2 argumen. Argumen ke-1 menerima <code>Context</code>. Sedangkan argumen ke-2 menerima <code>Duration</code>.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#fff;font-weight:700>func</span> task(ctx context.Context, taskTime time.Duration) {
	str := <span style=color:#0ff;font-weight:700>&#34;&#34;</span>
	<span style=color:#fff;font-weight:700>select</span> {
	<span style=color:#fff;font-weight:700>case</span> &lt;-ctx.Done():
		str = <span style=color:#0ff;font-weight:700>`Aduh, udah timeout! padahal belum kelar.`</span>
		fmt.Println(str)
	<span style=color:#fff;font-weight:700>case</span> &lt;-time.After(taskTime):
		str = <span style=color:#0ff;font-weight:700>`Yes, mantap! kerjaan kelar.`</span>
		fmt.Println(str)
	}
}
</code></pre></div><p>Argumen ke-1 digunakan untuk simulasi <code>timeout</code>. Sedang argumen ke-2 untuk simulasi berapa lama waktu yang diperlukan untuk menyelesaikan task tsb.</p>
<blockquote>
<p><em>Kode di atas menggunakan channel. Info selengkapnya bisa diakses di sini: <a href=https://go.dev/tour/concurrency/2>https://go.dev/tour/concurrency/2</a></em></p>
</blockquote>
<h3 id=pekerjaan-belum-selesai-tapi-sudah-timeout>Pekerjaan belum selesai, tapi sudah timeout<a hidden class=anchor aria-hidden=true href=#pekerjaan-belum-selesai-tapi-sudah-timeout>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#fff;font-weight:700>func</span> main() {
	fmt.Println(<span style=color:#0ff;font-weight:700>`Contoh: kerjaan belum selesai tapi sudah timeout:`</span>)

	durasiKerjaan := <span style=color:#ff0;font-weight:700>3</span> * time.Second <span style=color:#007f7f>// 3 detik
</span><span style=color:#007f7f></span>	timeout := time.Second           <span style=color:#007f7f>// 1 detik
</span><span style=color:#007f7f></span>
	ctx, cancel := context.WithTimeout(context.Background(), timeout)
	<span style=color:#fff;font-weight:700>defer</span> cancel()
	task(ctx, durasiKerjaan)
}
</code></pre></div><p><em>Kode selengkapnya: <a href=https://go.dev/play/p/impUqbQpB7r>lihat di sini</a></em></p>
<p>Pada kode di atas, durasi task adalah 3 detik. Tapi timeout-nya lebih cepat.</p>
<p>Sehingga jika kode di atas kita jalankan, hasilnya:</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Contoh: kerjaan belum selesai tapi sudah timeout:
Aduh, udah timeout! padahal belum kelar.
</code></pre></div><h3 id=pekerjaan-sudah-selesai-duluan-sebelum-timeout>Pekerjaan sudah selesai duluan sebelum timeout<a hidden class=anchor aria-hidden=true href=#pekerjaan-sudah-selesai-duluan-sebelum-timeout>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#fff;font-weight:700>func</span> main() {
	fmt.Println(<span style=color:#0ff;font-weight:700>`Contoh: kerjaan sudah selesai duluan`</span>)

	durasiKerjaan := time.Second <span style=color:#007f7f>// 1 detik
</span><span style=color:#007f7f></span>	timeout := <span style=color:#ff0;font-weight:700>3</span> * time.Second   <span style=color:#007f7f>// 3 detik
</span><span style=color:#007f7f></span>
	ctx, cancel := context.WithTimeout(context.Background(), timeout)
	<span style=color:#fff;font-weight:700>defer</span> cancel()
	task(ctx, durasiKerjaan)
}
</code></pre></div><p><em>Kode selengkapnya: <a href=https://go.dev/play/p/WUbpaz5pRZq>lihat di sini</a></em></p>
<p>Pada kode di atas, durasi kerjaan 1 detik. Sedangkan timeout 3 detik.</p>
<p>Sehingga jika kita jalankan, hasilnya:</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Contoh: kerjaan sudah selesai duluan
Yes, mantap! kerjaan kelar.
</code></pre></div><h3 id=kesimpulan>Kesimpulan<a hidden class=anchor aria-hidden=true href=#kesimpulan>#</a></h3>
<p>Kita bisa menggunakan <code>context.WithTimeout</code> jika ingin menambahkan pembatalan sebuah pekerjaan jika durasinya melebihi <code>timeout</code>.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://fastro.dev/tags/go/>go</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://fastro.dev/posts/cancel/>
<span class=title>« Prev Page</span>
<br>
<span>Cancel</span>
</a>
<a class=next href=https://fastro.dev/posts/marshal/>
<span class=title>Next Page »</span>
<br>
<span>Marshal</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://fastro.dev>Fastro</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>