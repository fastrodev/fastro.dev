<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Test | Fastro</title>
<meta name=keywords content="go">
<meta name=description content="Memahami cara test di golang dan cara menggunakannya di mongodb">
<meta name=author content="
Admin">
<link rel=canonical href=https://fastro.dev/posts/test/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c5b21ba3e7fcf6cf4864656416c0b45547191189c7a1c61e231ae02b81609c4b.css integrity="sha256-xbIbo+f89s9IZGVkFsC0VUcZEYnHocYeIxrgK4FgnEs=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fastro.dev/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://fastro.dev/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://fastro.dev/favicon-32x32.png>
<link rel=apple-touch-icon href=https://fastro.dev/apple-touch-icon.png>
<link rel=mask-icon href=https://fastro.dev/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.91.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-165990288-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Test">
<meta property="og:description" content="Memahami cara test di golang dan cara menggunakannya di mongodb">
<meta property="og:type" content="article">
<meta property="og:url" content="https://fastro.dev/posts/test/"><meta property="og:image" content="https://fastro.dev/seo.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-12-27T00:00:00+00:00">
<meta property="article:modified_time" content="2021-12-27T00:00:00+00:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://fastro.dev/seo.png">
<meta name=twitter:title content="Test">
<meta name=twitter:description content="Memahami cara test di golang dan cara menggunakannya di mongodb">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://fastro.dev/posts/"},{"@type":"ListItem","position":3,"name":"Test","item":"https://fastro.dev/posts/test/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Test","name":"Test","description":"Memahami cara test di golang dan cara menggunakannya di mongodb","keywords":["go"],"articleBody":"Catatan ini berisi penjelasan se-simple mungkin tentang cara testing di golang cara menggunakannya di mongodb.\nPendahuluan Pada catatan sebelumnya kita telah menggunakan context dan cancel di mongodb. Pada tulisan kali ini kita akan membahas bagaimana cara melakukan testing di mongodb.\nPersiapan Kita akan sedikit melakukan perubahan pada fungsi createBookRepository agar instance dari collection bisa kita generate dari luar fungsi.\nfunc createBookRepository( collection *mongo.Collection, timeout time.Duration, ) *repository { return \u0026repository{ collection: collection, timeout: timeout, } } Jika sebelumnya collection kita buat di dalam fungsi, kali ini kita pindahkan dia ke dalam fungsi terpisah.\nfunc createCollection( ctx context.Context, timeout time.Duration, uri, db, col string, ) (*mongo.Collection, error) { ctx, cancel := context.WithTimeout(ctx, timeout) defer cancel() client, err := mongo.Connect(ctx, options.Client().ApplyURI(uri)) if err != nil { return nil, err } return client.Database(db).Collection(col), nil } Kode selengkapnya: bisa diakses di sini\nIni kita lakukan agar kita bisa membuat simulasi koneksi database yang berhasil dan gagal. Simulasi sukses dan gagal tersebut akan kita gunakan ketika testing.\nTest createBookRepository  Buka source-code dengan vs-code. Arahkan pointer di atas fungsi createBookRepository. Klik kanan, lalu pilih Go: Generate Unit Tests This Function  Jika ok, nanti akan muncul file baru: main_test.go func Test_createBookRepository(t *testing.T) { type args struct { collection *mongo.Collection timeout time.Duration } tests := []struct { name string args args want *repository }{ // TODO: Add test cases.  } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { if got := createBookRepository(tt.args.collection, tt.args.timeout); !reflect.DeepEqual(got, tt.want) { t.Errorf(\"createBookRepository() = %v, want %v\", got, tt.want) } }) } }  Ganti // TODO: Add test cases. dengan input dan output yang kita inginkan. Jika sukses harapannya apa. Jika gagal harapannya apa. { name: \"success create repository\", args: args{ collection: successCollection, timeout: timeout, }, want: \u0026repository{ collection: successCollection, timeout: timeout, }, }, { name: \"fail create collection\", args: args{ collection: errCollection, timeout: timeout, }, want: \u0026repository{ collection: errCollection, timeout: timeout, }, }, Kode selengkapnya: bisa diakses di sini  Cara testing Buka terminal dan ketik command berikut:\ngo test -run Test_createBookRepository -v Hasilnya:\n=== RUN Test_createBookRepository === RUN Test_createBookRepository/success_create_repository === RUN Test_createBookRepository/fail_create_collection --- PASS: Test_createBookRepository (0.06s) --- PASS: Test_createBookRepository/success_create_repository (0.00s) --- PASS: Test_createBookRepository/fail_create_collection (0.00s) PASS ok praktikum-crud 0.262s ","wordCount":"358","inLanguage":"en","datePublished":"2021-12-27T00:00:00Z","dateModified":"2021-12-27T00:00:00Z","author":{"@type":"Person","name":"Admin"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fastro.dev/posts/test/"},"publisher":{"@type":"Organization","name":"Fastro","logo":{"@type":"ImageObject","url":"https://fastro.dev/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class="main-header header">
<nav class=nav>
<div class=logo>
<a href=https://fastro.dev accesskey=h title="Fastro (Alt + H)">
Fastro</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
</nav>
</header><main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Test
</h1>
<div class=post-meta><span title="2021-12-27 00:00:00 +0000 UTC">December 27, 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;
<a href=/authors/admin/>Admin</a>&nbsp;|&nbsp;<a href=https://github.com/fastrodev/fastrodev.github.io/blob/main/content/posts/test/index.md rel="noopener noreferrer" target=_blank>Update</a>
</div>
</header> <div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#pendahuluan aria-label=Pendahuluan>Pendahuluan</a></li>
<li>
<a href=#persiapan aria-label=Persiapan>Persiapan</a></li>
<li>
<a href=#test-createbookrepository aria-label="Test createBookRepository">Test createBookRepository</a></li>
<li>
<a href=#cara-testing aria-label="Cara testing">Cara testing</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>Catatan ini berisi penjelasan <em>se-simple</em> mungkin tentang cara testing di golang cara menggunakannya di mongodb.</p>
<h3 id=pendahuluan>Pendahuluan<a hidden class=anchor aria-hidden=true href=#pendahuluan>#</a></h3>
<p>Pada <a href=/posts/cancel>catatan sebelumnya</a> kita telah menggunakan context dan cancel di mongodb. Pada tulisan kali ini kita akan membahas bagaimana cara melakukan testing di mongodb.</p>
<h3 id=persiapan>Persiapan<a hidden class=anchor aria-hidden=true href=#persiapan>#</a></h3>
<p>Kita akan sedikit melakukan perubahan pada fungsi <code>createBookRepository</code> agar instance dari collection bisa kita generate dari luar fungsi.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#fff;font-weight:700>func</span> createBookRepository(
	collection *mongo.Collection,
	timeout time.Duration,
) *repository {
	<span style=color:#fff;font-weight:700>return</span> &amp;repository{
		collection: collection,
		timeout:    timeout,
	}
}
</code></pre></div><p>Jika sebelumnya <code>collection</code> kita buat di dalam fungsi, kali ini kita pindahkan dia ke dalam fungsi terpisah.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#fff;font-weight:700>func</span> createCollection(
	ctx context.Context,
	timeout time.Duration,
	uri, db, col <span style=color:#fff;font-weight:700>string</span>,
) (*mongo.Collection, <span style=color:#fff;font-weight:700>error</span>) {
	ctx, cancel := context.WithTimeout(ctx, timeout)
	<span style=color:#fff;font-weight:700>defer</span> cancel()

	client, err := mongo.Connect(ctx, options.Client().ApplyURI(uri))
	<span style=color:#fff;font-weight:700>if</span> err != <span style=color:#fff;font-weight:700>nil</span> {
		<span style=color:#fff;font-weight:700>return</span> <span style=color:#fff;font-weight:700>nil</span>, err
	}
	<span style=color:#fff;font-weight:700>return</span> client.Database(db).Collection(col), <span style=color:#fff;font-weight:700>nil</span>
}
</code></pre></div><p><em>Kode selengkapnya: <a href=https://github.com/fastrodev/praktikum-repository/blob/f1e0933fa47cb725aefd0499093fa560ab7c4a69/main.go#L31>bisa diakses di sini</a></em></p>
<p>Ini kita lakukan agar kita bisa membuat simulasi koneksi database yang berhasil dan gagal. Simulasi sukses dan gagal tersebut akan kita gunakan ketika testing.</p>
<h3 id=test-createbookrepository>Test createBookRepository<a hidden class=anchor aria-hidden=true href=#test-createbookrepository>#</a></h3>
<ol>
<li>Buka source-code dengan <a href=https://code.visualstudio.com/>vs-code</a>.</li>
<li>Arahkan pointer di atas fungsi <code>createBookRepository</code>.</li>
<li>Klik kanan, lalu pilih <code>Go: Generate Unit Tests This Function</code>
<img loading=lazy src=pop.png alt>
</li>
<li>Jika ok, nanti akan muncul file baru: <code>main_test.go</code>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#fff;font-weight:700>func</span> Test_createBookRepository(t *testing.T) {
    <span style=color:#fff;font-weight:700>type</span> args <span style=color:#fff;font-weight:700>struct</span> {
        collection *mongo.Collection
        timeout    time.Duration
    }
    tests := []<span style=color:#fff;font-weight:700>struct</span> {
        name <span style=color:#fff;font-weight:700>string</span>
        args args
        want *repository
    }{
        <span style=color:#007f7f>// TODO: Add test cases.
</span><span style=color:#007f7f></span>    }
    <span style=color:#fff;font-weight:700>for</span> _, tt := <span style=color:#fff;font-weight:700>range</span> tests {
        t.Run(tt.name, <span style=color:#fff;font-weight:700>func</span>(t *testing.T) {
            <span style=color:#fff;font-weight:700>if</span> got := createBookRepository(tt.args.collection, tt.args.timeout); !reflect.DeepEqual(got, tt.want) {
                t.Errorf(<span style=color:#0ff;font-weight:700>&#34;createBookRepository() = %v, want %v&#34;</span>, got, tt.want)
            }
        })
    }
}
</code></pre></div></li>
<li>Ganti <code>// TODO: Add test cases.</code> dengan input dan output yang kita inginkan. Jika sukses harapannya apa. Jika gagal harapannya apa.
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>{
    name: <span style=color:#0ff;font-weight:700>&#34;success create repository&#34;</span>,
    args: args{
        collection: successCollection,
        timeout:    timeout,
    },
    want: &amp;repository{
        collection: successCollection,
        timeout:    timeout,
    },
},
{
    name: <span style=color:#0ff;font-weight:700>&#34;fail create collection&#34;</span>,
    args: args{
        collection: errCollection,
        timeout:    timeout,
    },
    want: &amp;repository{
        collection: errCollection,
        timeout:    timeout,
    },
},
</code></pre></div><em>Kode selengkapnya: <a href=https://github.com/fastrodev/praktikum-repository/blob/test/main_test.go>bisa diakses di sini</a></em></li>
</ol>
<h3 id=cara-testing>Cara testing<a hidden class=anchor aria-hidden=true href=#cara-testing>#</a></h3>
<p>Buka terminal dan ketik command berikut:</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>go test -run Test_createBookRepository -v
</code></pre></div><p>Hasilnya:</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>=== RUN   Test_createBookRepository
=== RUN   Test_createBookRepository/success_create_repository
=== RUN   Test_createBookRepository/fail_create_collection
--- PASS: Test_createBookRepository (0.06s)
    --- PASS: Test_createBookRepository/success_create_repository (0.00s)
    --- PASS: Test_createBookRepository/fail_create_collection (0.00s)
PASS
ok      praktikum-crud  0.262s
</code></pre></div>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://fastro.dev/tags/go/>go</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://fastro.dev/posts/interface/>
<span class=title>« Prev Page</span>
<br>
<span>Interface</span>
</a>
<a class=next href=https://fastro.dev/posts/cancel/>
<span class=title>Next Page »</span>
<br>
<span>Cancel</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://fastro.dev>Fastro</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>